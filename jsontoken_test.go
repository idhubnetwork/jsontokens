package jsontokens

import (
	"fmt"
	"testing"
)

var privateKey = "0x06da20d5a2ffdeb3f5b6bca5199a28d63a6efec4b1b8b9c6c493fc532ed324ec"

var token = "0x7b226d7367223a223078376232323631363337343639366636653232336132323433353234353431353434353232326332323634363537333734363936653631373436393666366532323361323237353732366332323263323236343639363432323361323236343639363433613639363436383735363233613330373833373435363234353435333936313338343133333335333333303636363433313635333533343330333133373433333333393335333933323431333536313339333536313636333933393634333033373232326332323635373837303639373236313734363936663665323233613331333533343334333433333338333533333337326332323661373737343566363137353634323233613232363436393634336136393634363837353632336133303738333433393634343236313338363633393330333636333337333433353432333036313338333236363334343433323331343533303332343234313436343433373434363633313631333036323635333432323263323236613737373435663639373337333232336132323634363936343361363936343638373536323361333037383337343536323435343533393631333834313333333533333330363636343331363533353334333033313337343333333339333533393332343133353631333933353631363633393339363433303337323232633232366137373734356636613734363932323361333533383338333233353263323236613737373435663733373536323232336133313764222c22736967223a22307863613531323839656633336264626536343464626432636335366535363037616264633530623866353239303531343663613361333532383531643336306265346366636634646462643337313161373937306133663361373130366536646530663865373337666464616232636238626366653938356562656464623762343163227d"

func TestGetToken(t *testing.T) {
	fmt.Println(1)
	jt := NewJsonToken()
	fmt.Println(2)
	jt.Set("name", "idhub")
	jt.Set("type", "test")
	jt.Set("did", "did:idhub:0x7EbEE9a8A3530fd1e54017C39592A5a95af99d07")
	fmt.Println(3)
	fmt.Println(jt.Get("name"))
	err := jt.Sign(privateKey)
	if err != nil {
		fmt.Println(err)
		t.Fail()
	}
	fmt.Println(jt)
	token, err := jt.GetToken()
	if err != nil {
		fmt.Println(err)
		t.Fail()
	}
	fmt.Println(jt.ClaimJson)
	fmt.Println(token)
	fmt.Println("success")
}

func TestSetToken(t *testing.T) {
	jt := NewJsonToken()
	err := jt.SetToken(token)
	if err != nil {
		fmt.Println(err)
		t.Fail()
	}
	fmt.Println(jt.Get("name"))
	fmt.Println(jt.Get("type"))
	fmt.Println(jt.ClaimJson)
	fmt.Println(jt.Signature)
}

func TestVerifyJsonToken(t *testing.T) {
	jt := NewJsonToken()
	err := jt.SetToken(token)
	if err != nil {
		fmt.Println(err)
		t.Fail()
	}

	err = jt.Verify()
	if err != nil {
		fmt.Println(err)
		t.Fail()
	}
}
